q^2 + (n - q - 1)^2 = 2(q - (n - 1) / 2)^2 + (n - 1)^2 / 2
This is clearly maximised by choosing q to maximise |q - (n - 1) / 2|.
So the maximum value over q = 0, 1, 2, ..., n - 1 is obtained for q = 0 or n - 1.
